generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String           @id @default(cuid())
  clerkId         String?          @unique
  email           String           @unique
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  onboarding      UserOnboarding?
  photos          UserPhoto[]
  diningImages    DiningImage[]
  events          Event[]
}

model UserOnboarding {
  id                String                @id @default(cuid())
  userId            String                @unique
  user              User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  firstName         String
  lastName          String
  addressDetails    Address?
  phoneNumber       String
  guestPreferences  UserGuestPreferences?
  hostPreferences   UserHostPreferences?
  completedSteps    Int                   @default(0)
  isCompleted       Boolean               @default(false)
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  familyMembers     FamilyMember[]
  pets              Pet[]
}

model UserGuestPreferences {
  id                         String         @id @default(cuid())
  onboardingId               String         @unique
  onboarding                 UserOnboarding @relation(fields: [onboardingId], references: [id], onDelete: Cascade)

  dietaryRestrictions        String[]
  dietaryRestrictionsOther   String?
  strongDislikes             String?
  alcoholStance              String?
  smokingAsGuest             String[]
  smokingAsGuestOther        String?
  spiceLevel                 String?
  petsBotherYou              Boolean?
  contributionPreference     String?
  additionalNotes            String?

  createdAt                  DateTime       @default(now())
  updatedAt                  DateTime       @updatedAt
}

model UserHostPreferences {
  id                    String         @id @default(cuid())
  onboardingId          String         @unique
  onboarding            UserOnboarding @relation(fields: [onboardingId], references: [id], onDelete: Cascade)

  smokingAsHost         String[]
  smokingAsHostOther    String?
  eventTypes            String[]
  preferredAgeRange     String?
  noiseLevel            String?
  kidsOkay              Boolean?
  byobPotluckOkay       Boolean?

  propertyType          String?
  neighborhoodNotes     String?
  maxGuests             Int?
  indoorOutdoorSeating  String?
  diningTableSize       Int?
  accessibility         String[]
  parking               String[]
  publicTransportInfo   String?
  hasPets               Boolean?
  hypoallergenicPet     Boolean?
  petsFreeRoam          Boolean?
  quietHours            String?
  shoesOff              Boolean?
  diningAreaPhotos      String[]
  additionalNotes       String?

  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
}

model FamilyMember {
  id              String           @id @default(cuid())
  onboardingId    String
  onboarding      UserOnboarding   @relation(fields: [onboardingId], references: [id], onDelete: Cascade)
  name            String
  age             Int?
  relationship    String?
  createdAt       DateTime         @default(now())
}

model Pet {
  id              String           @id @default(cuid())
  onboardingId    String
  onboarding      UserOnboarding   @relation(fields: [onboardingId], references: [id], onDelete: Cascade)
  name            String
  kind            String?
  createdAt       DateTime         @default(now())
}

model Address {
  id                    String         @id @default(cuid())
  onboardingId          String         @unique
  onboarding            UserOnboarding @relation(fields: [onboardingId], references: [id], onDelete: Cascade)

  // Geoapify API data for programmatic use
  lon                   Float?
  lat                   Float?
  postalCode            String?

  // Confidence levels from Geoapify
  confidenceStreetLevel Float?
  confidenceCityLevel   Float?

  // Full address data for display
  formattedAddress      String
  streetName            String?
  houseNumber           String?
  city                  String?
  state                 String?
  country               String?

  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
}

model UserPhoto {
  id          String    @id @default(cuid())
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  url         String
  width       Int?
  height      Int?
  cropX       Float?
  cropY       Float?
  cropWidth   Float?
  cropHeight  Float?
  order       Int
  caption     String?
  createdAt   DateTime  @default(now())
}

model DiningImage {
  id          String    @id @default(cuid())
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  url         String
  width       Int?
  height      Int?
  cropX       Float?
  cropY       Float?
  cropWidth   Float?
  cropHeight  Float?
  order       Int
  caption     String?
  isPrimary   Boolean   @default(false)
  createdAt   DateTime  @default(now())
}

enum EventStatus {
  draft
  pending
  active
  cancelled
}

model Event {
  id                String        @id @default(cuid())
  userId            String
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  slug              String        @unique
  status            EventStatus   @default(draft)
  viewCount         Int           @default(0)

  title             String
  occasionType      String
  eventDate         DateTime
  startTime         String
  endTime           String?
  description       String?

  formattedAddress  String?
  streetName        String?
  houseNumber       String?
  city              String?
  state             String?
  country           String?
  postalCode        String?
  lat               Float?
  lon               Float?
  neighborhood      String?
  accessibility     String[]
  parking           String?

  cuisineTheme      String[]
  customCuisineTheme String?
  proposedMenu      String[]
  isKosher          Boolean?
  isVegetarian      Boolean?
  isGlutenFree      Boolean?
  hasNuts           Boolean?
  hasDairy          Boolean?
  accommodatesDietary String[]

  maxGuests         Int
  minGuests         Int?
  kidFriendly       Boolean?
  petFriendly       Boolean?
  smokingAllowed    Boolean?
  alcoholProvided   Boolean?
  byob              Boolean?
  whoElsePresent    String[]

  atmosphereTags    String[]
  houseRules        String?

  contributionType  String?
  contributionAmount Float?

  photos            EventPhoto[]

  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@index([userId])
  @@index([slug])
  @@index([status])
  @@index([eventDate])
}

model EventPhoto {
  id          String    @id @default(cuid())
  eventId     String
  event       Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  url         String
  width       Int?
  height      Int?
  cropX       Float?
  cropY       Float?
  cropWidth   Float?
  cropHeight  Float?
  order       Int
  caption     String?
  createdAt   DateTime  @default(now())
}

